{% extends "base.html" %}

{% block title %}Predict Sentiment{% endblock %}

{% block content %}
<!-- Page Title -->
<h1 class="text-3xl font-bold text-slate-900 mb-2">Analyze Sentiment</h1>
<p class="text-lg text-slate-500 mb-8">Enter a tweet or upload a CSV file to get an AI-powered sentiment prediction.</p>

<!-- Main Content Card -->
<div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg max-w-3xl mx-auto">
    
    <!-- Form -->
    <form id="prediction-form" method="POST" action="{{ url_for('main.index') }}" enctype="multipart/form-data" class="space-y-6">
        {{ form.hidden_tag() }}
        
        <div>
            <label for="tweet-text" class="block text-sm font-medium text-slate-700 mb-1">Enter a Tweet</label>
            {{ form.tweet_text(id="tweet-text", rows="4", class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition", placeholder="e.g., 'Flight delayed again! Terrible customer service.'") }}
            {% if form.tweet_text.errors %}
                <p class="mt-2 text-sm text-red-600">{{ form.tweet_text.errors[0] }}</p>
            {% endif %}
        </div>

        <div class="relative">
            <div class="absolute inset-0 flex items-center">
                <span class="w-full border-t border-slate-300"></span>
            </div>
            <div class="relative flex justify-center text-sm">
                <span class="px-2 bg-white text-slate-500">or</span>
            </div>
        </div>

        <!-- Custom-Styled File Upload -->
        <div>
            <label for="csv-upload" class="relative flex flex-col items-center justify-center w-full h-32 px-4 py-6 bg-white border-2 border-slate-300 border-dashed rounded-lg cursor-pointer hover:bg-slate-50 transition">
                <div class="text-center">
                    <i data-lucide="upload-cloud" class="h-8 w-8 text-slate-400 mx-auto"></i>
                    <p class="mt-2 text-sm font-medium text-slate-600">
                        <span class="text-orange-600">Click to upload</span> or drag and drop
                    </p>
                    <p class="mt-1 text-xs text-slate-500">CSV file (max. 5MB)</p>
                </div>
                {{ form.batch_file(id="csv-upload", class="sr-only") }}
            </label>
            {% if form.batch_file.errors %}
                <p class="mt-2 text-sm text-red-600">{{ form.batch_file.errors[0] }}</p>
            {% endif %}
        </div>
        
        <!-- Submit Button -->
        <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition duration-150 flex items-center justify-center">
            <i data-lucide="wand-sparkles" class="mr-2 h-5 w-5"></i>
            Analyze
        </button>
    </form>

    {% if prediction %}
    <!-- PREDICTION RESULT -->
    <div id="prediction-result" class="border-t border-slate-200 mt-8 pt-8">
        <h2 class="text-xl font-semibold text-slate-900 mb-6">Prediction Result</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Sentiment Card -->
            <div class="bg-slate-50 p-6 rounded-lg">
                <div class="text-sm font-medium text-slate-500 mb-2">Sentiment</div>
                <div id="sentiment-tag" class="text-2xl font-bold inline-flex items-center px-4 py-1 rounded-full 
                    {% if prediction.sentiment == 'positive' %} bg-green-100 text-green-700 
                    {% elif prediction.sentiment == 'negative' %} bg-red-100 text-red-700
                    {% else %} bg-slate-100 text-slate-700 {% endif %}
                ">
                    {{ prediction.sentiment|upper }}
                </div>
            </div>
            <!-- Confidence Card -->
            <div class="bg-slate-50 p-6 rounded-lg">
                <div class="text-sm font-medium text-slate-500 mb-2">Confidence</div>
                <div id="confidence-score" class="text-3xl font-bold text-slate-900">
                    {% if prediction.confidence %}
                        {{ (prediction.confidence * 100)|round(1) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </div>
            </div>
        </div>

        {% if prediction.top_features %}
        <!-- Key Indicators -->
        <div class="mt-6">
            <h3 class="text-base font-medium text-slate-700 mb-3">Why this prediction?</h3>
            <p class="text-sm text-slate-500 mb-2">Key indicators detected in text:</p>
            <div id="keyword-tags" class="flex flex-wrap gap-2">
                {% for feature in prediction.top_features[:5] %}
                <span class="px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-sm font-medium">{{ feature }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}